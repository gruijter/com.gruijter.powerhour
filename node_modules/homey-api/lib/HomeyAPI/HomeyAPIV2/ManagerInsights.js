'use strict';

const ManagerInsightsV3 = require('../HomeyAPIV3/ManagerInsights');
const Log = require('./ManagerInsights/Log');

class ManagerInsights extends ManagerInsightsV3 {
  static CRUD = {
    ...super.CRUD,
    Log,
  };

  async getLog({ $cache = true, id }) {
    if ($cache === true && this.__cache['log'][id]) {
      return this.__cache['log'][id];
    }

    return this.__super__getLog({
      id: id.split(':').reverse()[0],
      uri: id.split(':', 3).join(':'),
    });
  }

  async getLogEntries({ id, resolution }) {
    const result = await this.__super__getLogEntries({
      id: id.split(':').reverse()[0],
      uri: id.split(':', 3).join(':'),
      resolution,
    });

    return {
      ...result,
      id: id,
    };
  }

  async deleteLogEntries({ id }) {
    return this.__super__deleteLogEntries({
      id: id.split(':').reverse()[0],
      uri: id.split(':', 3).join(':'),
    });
  }

  // deleteLog
  // updateLog
}

module.exports = ManagerInsights;
